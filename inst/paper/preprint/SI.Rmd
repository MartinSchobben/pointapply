\setcounter{section}{0}
\setcounter{figure}{0}
\setcounter{table}{0}
\setcounter{equation}{0}

# Supplementary Methods and Data

## Software for data treatment, statistics, and visualization

Raw data was generated by the default Cameca^TM^ software in ion mapping modus. The algorithms of the Matlab-based software Look\@NanoSIMS [@Polerecky2012] were used for alignment and accumulation of the pixels along the measured frames with depth. The systematic biases for dead-time and electron multiplier yield are also corrected with this software package. Further treatment of the data was performed in the R environment [@rversion] with the package *point* [@point] for ion count statistics. This R package was extended to include the here-discussed diagnostic tools and inference tests for intra- and inter-isotopic variability. Rmarkdown files are used for the manuscript, supplementary information and the documentation of data reduction and simulation protocols *knitr* [@knitr1 ; @knitr2], *rmarkdown* [@rmarkdown1; @rmarkdown2] with further aid from the packages; *Cairo* for better images, *bibtex* for reference management, and *kableExtra* for tables. These documents further rely on the packages;  *tidyverse* [@tidyverse] for graphs and data transformation, *here* [@here] for convenient declaration of the relative path to a file, *R.matlab* [@R.matlab] for reading matlab files, and *cubelyr* [@cubelyr] for transformation of arrays into long format data-frames. 


## Protocol for data simulation {#sec:protocol1}

The function `simu_R()` of the R package *point* [@point] was used to simulate ion count data for ^12^C and ^13^C, and it adds the fundamental imprecision of ion count data by random number generation following a Poisson distribution [where the latter is a good approximation of this uncertainty, see e.g. @Fitzsimons2000a].  This function, furthermore, offers the possibility to produce isotope ratios that approximate natural conditions, by using the VPDB-scale as a reference framework [@Coplen2006]. Three possible scenarios can be simulated for intra-isotopic variability (variance of $R$ within single analysis); "ideal", with stable $R_{i}$ throughout the analyses; "symmetric", with a sudden shift in $R_{i}$ (Eq. \@ref(eq:symR)); and "asymmetric", with a gradual but constant linear change in $R_{i}$  (Eq. \@ref(eq:asymR)) (see also main text and Fig. \@ref(fig:concept)). For the sensitivity experiment the latter two options of $R$ variability are tested over a range `r permille(-22, sign = TRUE)` to `r permille(0)`. In addition, the function `simu_R()` allows correlated variation among both isotopes in order to mimic the efficiency of secondary ion extraction, which is an aspect of charge build-up and sputter-pit depth and -geometry development with the on-going analysis [@Fitzsimons2000a]. The variability of the simulated ionization efficiency was quantified as the difference between the descriptive relative standard deviation ($\epsilon_{X^{a}}$) and the theoretical standard deviation ($\hat{\epsilon}_{X^{a}}$) of the common isotope (see Supplementary Section \@ref(sec:precision)). The simulated ion yield efficiency was then tested over a range of $160$%. This procedure was repeated $15$ times, after which, the outlier detection methods; $\sigma_{R}$-rejection and Cook's D (see main text) were used to analyse the data (see main text for details), and thereby forming the basis for the sensitivity test, which are summarised in the heatmap (Fig. \@ref(fig:effect)) and the sensitivity/specificity lineplot (Fig. \@ref(fig:sens)) 

The same range of ion yield efficiency (as for intra-isotope variability) was used to test the sensitivity of the inter-isotope variability test (main text), but now the setting for intra-isotope variability was set to "ideal", in order to produce homogeneous analysis in respect to $R$. Instead, the starting value  $R_{\text{input}}$ (where $R_{\text{input}} \approx \bar{R}$) was varied over a range of `r permille(-11, sign = TRUE)` to `r permille(0)` (also on the VPDB-sale) for one out of 10 analysis. This mimics the influence of one anomalous analysis out of an $m$-series of analyses and forms the basis to gauge the sensitivity of the inter-isotope variability test (outlined in the main text) and summarised in the heatmap (Fig. \@ref(fig:heatmap2)). The R code for the data simulation, the specific test for intra- and inter-isotope variability, and visualization can be found in the files `simu_sens_IC.Rmd` and `simu_performance_IC.Rmd` and `simu_graphs_IC.Rmd`, respectively, in the subdirectory `data-raw`.  


## Protocol for real data pre-processing {#sec:protocol2}

The matlab generated were loaded in the R environment with the function `readMat()` (of the R package: *R.matlab*). The data consists of an array encompassing the width (`r SI(256, "pixel", "in")`), height (`r SI(256, "pixel", "in")`) and depth (i.e., the consecutive frames of the analysis with depth; $400$ frames) of the analysis. For high-precision ^13^C/^12^C analysis the array was divided over a grid. This grid was defined as an exponent with base $2$ in order to equally divide the whole area. Grid-cell size was varied to allow an assessment of the optimal size for consecutive analyses on $R$, yielding sizes of `r sapply(sapply(2:6, function(x) 2^x), sprintf, fmt = "%.0f")` and `r SI(128, "pixel", "in")`. Based on the known dimensions of the measured area `r SI(40, c("micro", "metre"))` by `r SI(40, c("micro", "metre"))`, this translates to grid-cell sizes of `r sapply(c(0.63, 1.25, 2.50, 5.00, 10.00), sprintf, fmt = "%.2f")` and `r SI(20, c("micro", "metre"))`. In turn, the array was flattened into a long format data-frame with aid of the R package *cubelyr* for further data aggregation. For aggregation over the width and height, the maximum number of frames was taken as the second dimension. In addition, pixel-by-pixel ion maps for `r point::R_labeller("12C", "40Ca-16O")` and  `r point::R_labeller("12C-14N", "12C")`were generated by aggregation over depth, width and height. The R code for loading the matlab file and consecutive transformation and aggregation of the ion arrays can be found in the Rmarkdown file `read_matlab.Rmd` in the subdirectory `data-raw`. 


```{r gridsketch, fig.cap=paste0("Layout and numbering of the ", SI(10, c("micro", "metre")), "$\\times$", SI(10, c("micro", "metre")), " grid-cell sizes of Figs \\ref{fig:MON} and \\ref{fig:MEX}, and Supplementary Fig. \\ref{fig:nitro1}.")}
knitr::include_graphics(here("figures/grid_sketch.png"))
```


Diagnostic tools for linear regression (such as normality, constant variance and independence of residuals; in `point` R package) are applied to the data accumulated for the different grid-cell sizes. This approach allows the selection of the optimal grid-cell size for ^13^C/^12^C analysis (see also main text). After the grid-size selection, the precision of ^13^C/^12^C analysis is assessed  with descriptive and predictive statistics (the latter is based on Poisson statistics, see Supplementary Section \@ref(sec:precision)) following the documentation for the `point` R package and the formulations as outlined by @Fitzsimons2000a. This is finally supplemented with the intra- and inter-isotope variability test as documented in the main paper. The code for pre-processing (and visualization) of ^13^C/^12^C analysis as well as the production of the raster images for the ion-maps is included in the Rmarkdown file `SIMS_maps_processing.Rmd` in the subdirectory `data-raw`. 


# Supplementary Results and Discussion

## Precision of isotope analysis {#sec:precision}

Precision is a fundamental aspect of SIMS isotope analysis, as it dictates the degree to which, for example, a set of analyses along a transect on a mineral surface can be compared to each other. If this inter-isotopic variation is close to the analytical uncertainty, then the information extracted from such a study becomes less meaningful. This is an additional factor that can interfere with RM value assignment, besides the trueness of a value, as targeted in this study, which essentially evaluates whether the mean value is representative of the underlying data. Where the later could theoretically re-surface in the precision of a single analysis or an $m$-series of analysis, if confronted with, respectively, intra- and/or inter-isotopic variation of the substrate. However, the fundamental imprecision likely governed by a quantum effect implicated with ionization during sputtering[@Schroeer1973; @Shimizu1982], and approximated by count (Poisson) statistics [@Fitzsimons2000a]. This can explain why the spread in ion count data can be on the order of $10$s of `r permille(NULL, sign = TRUE)`, where this spread can be described by the standard deviation of a sample [see e.g. @Fitzsimons2000a].

\begin{equation}
s_{X^a} = \sqrt{\sum_{i=1}^{n}  \frac{(X_{i}^a-\bar{X}^a)^2}{n-1}} (\#eq:sd)
\end{equation}

The large standard deviation of SIMS isotope analysis, is often accommodated by the production of a large number of counts ($N\geq10^6$ for the rare isotope, e.g. ^13^C) with long analysis times as a results, thereby narrowing the precision of light element isotope ratios to within `r permille(-1)`. This can be expressed mathematically by the error of the mean, which becomes smaller with the square root of the number of observations.

\begin{equation}
s_{\bar{X}^a} = \frac{s_{X^a}}{\sqrt{n}} (\#eq:se)
\end{equation}

The formulation provided here, expressed as the count rate of a single ion, describes a probability interval of including the population mean. The $s_{X^a}$ and $s_{\bar{X}^a}$ can also expressed as a relative terms in `r permille(NULL, sign = TRUE)` by division through the mean ($\epsilon_{X} = (s_{X}/\bar{X})1000$ and $\epsilon_{\bar{X}} = (s_{\bar{X}}/\bar{X})1000$). In addition, the total counts per measurement $\bar{N}$ for species $a$ can be used to predict the standard deviation and maximum attainable precision under ideal circumstances (i.e., only affected by the fundamental imprecision, as described before; Section \@ref(sec:simulation)).

\begin{equation}
\hat{s}_{N^a} = \sqrt{\bar{N}^a}  \qquad \text{where} \qquad \bar{N}^a = \frac{1}{n}\sum_{i=1}^{n}N_i^a (\#eq:stdpois)
\end{equation}

\begin{equation}
  \hat{s}_{\bar{N}^a} = \sqrt{\left( \frac{ \bar{N}^a}{n}\right)} (\#eq:sepois)
\end{equation}

These predicted metrics for variance and precision can also be re-casted in relative `r permille(NULL)`-terms by division through the mean ($\hat{\epsilon}_{N} = (\hat{s}_{N}/\bar{N})1000$ and $\hat{\epsilon}_{\bar{N}} = (\hat{s}_{\bar{N}}/\bar{N})1000$). In additions, all these equations can be reformulated for isotopes ratios (ratios of means; Eq. \@ref(eq:estR)) with Taylor series expansion [see @Fitzsimons2000a; @point for detailed derivations]. A reduced $\chi^2$ test is, in turn, commonly applied to estimate how well the conditions during the measurement approximate the theoretical optimum, where values close to $1$ suggest good agreement [@Kilburn2015a].

\begin{equation}
\chi^2 = \left( \frac{s_{\bar{R}}} {\hat{s}_{\bar{R}}} \right)^2 (\#eq:chi2)
\end{equation}

The $\chi^2$ test statistic for ^13^C/^12^C analysis from the `r SI(10, c("micro", "metre"))`$\times$`r SI(10, c("micro", "metre"))` grid-cell sizes seems to indicate near ideal circumstances. This cast doubt on the often quoted mantra that chemical heterogeneity should have a noticeable effect on the precision of a SIMS isotope analysis [@Fitzsimons2000a]. A comparison of $\chi^2$ and $F$ test statistic for internal R variability highlights that even deviations in the upper-end of the sensitivity test (`r permille(-20, sign = TRUE)`) cause negligible deviation from unity in $\chi^2$ (Supplementary Fig \@ref(fig:accuracy)).


(ref:foot3) \@ref(fig:gridsketch)


```{r precision}
# footnote
ft <- paste0("See Fig. ", "(ref:foot3)", " for layout and numbering of grid-cells")
# table of precision stats
point::stat_R(tb_map_64, "13C", "12C", sample.nm, dim_name.nm, ROI.nm, .stat=c("M", "RSeM", "chi2"), .label = "latex") %>% 
  rename(`analyte` = "sample.nm", `dimension` = "dim_name.nm", `grid-cell*` = "ROI.nm") %>% 
  select(-R.nm) %>% 
# print  
  kableExtra::kable(
    booktabs = TRUE,  
    escape = FALSE,
    digits = c(1, 1, 1, 4, 1, 1),
    caption = paste0("Internal precision of $^{13}$C/$^{12}$C analysis on a $10.00\\times$", SI(10, c("micro", "metre")), "-grid")
    ) %>% 
  kableExtra::footnote(symbol =  ft,  threeparttable = TRUE, escape  = FALSE)
```


```{r accuracy, fig.cap="Comparison of F statistic for intra-isotopic variation with $\\chi^2$ test statistic for precision of the simulated data (see Section \\ref{sec:intra}). The bins; low, medium and high stand for ionization efficiency trend of $6-21$\\%, $22-37$\\%, $38-53$\\%, based on $\\hat{\\epsilon}_{X^{a}} - \\epsilon_{X^{a}}$."}
knitr::include_graphics(here("figures/simu_precision.png"))
```


## Validation of regression assumptions {#sec:validation}

The validity of inter- and intra- isotope models is verified for the nanoSIMS generated data by an assessment of the implicit assumptions of the linear regression model (Eq. \@ref(eq:linmodR)); normality, homogeneity and independence of residuals. Furthermore the regression assumption aid selection of the appropriate grid-cell size as mentioned in Section \@ref(sec:protocol2)). These assumptions are tested on the studentized residuals $\hat{e}_i^*$ after fitting the ideal "homogeneous" model (see Section \@ref(sec:RegDia) and Eq. \@ref(eq:studres) for derivations of the equations), and reflect upon the underlying data structure [@Zuur2008]. A visual examination of the normality of pooled $\hat{e}_i^*$ for the different grid-cell sizes can be achieved by means of a Quantile-Quantile comparison plot (*QQ normality plot*; Fig. \@ref(fig:QQdens)), where the empirical sample distribution is compared with a theoretical normal distribution, providing a means to distinguish $\hat{e}_i^*$ that deviate significantly from the normal assumption. The differences between the empirical and theoretical quantiles was also be formalized in an hypothesis test (*Anderson-Darling* hypothesis test). Based on an overview on the frequency of rejection of the $H0$ of normality, there seems to be a bias towards skewed distribution for grid-cell sizes smaller than `r SI(5, c("micro", "metre"))`, as expected based on count statistics, where $\bar{N} < 100$, seem to be detrimental to the assumptions of the ideal "homogeneous" model (\@ref(fig:hyp)). One can further deduce from Figure \@ref(fig:CVdens), that the variance centrers around zero regardless the grid-cell size. This can be further confirmed by a two-sided one-sample *Student's t* hypothesis test on the studentized result with  $H0$: $\mu_0 = 0$, and  $Ha$: $\mu_0 \neq 0$.


```{r QQdens, fig.cap="Normal Quantile-Quantile plot for aggregated studentized resiudals ($\\hat{e}_i^*$) for the different grid-cell sizes."}
knitr::include_graphics(here("figures", "point_QQ.png"))
```


The *scale location plot* (Fig. \@ref(fig:CVdens)) of $\hat{e}_i^*$, can also be used as a convenient way to check the assumption of constant variance and the existence of outliers, where values that deviate more than $3.5$ from zero are usually considered outliers. Patterns in the homogeneity of variance can indicate whether the linear model suffers from systematic variations in the residuals that are dependent on the fitted variable ($\hat{X}^b$) (heteroscedasticity); possibly compromising the estimates for the model's coefficient. The hypothesis test known as the *Breusch-Pagan* hypothesis test fits a linear model to the residuals in order to make inference about heteroscedasticity. A summary overview suggest that there is no strong reason to reject the $H0$ of homoscedasticity , and the assumption of constant variance seems to hold for all grid-cell sizes (\@ref(fig:hyp)).  However, a visual inspection of Fig. \@ref(fig:CVdens) seems to indicate a disproportionate number of residuals fall outside of the $3.5$ window at the lower end of ^13^C count rates for grid-cell size smaller than `r SI(5, c("micro", "metre"))`. This might again be a valid concern for the application of smaller than `r SI(5, c("micro", "metre"))` grid-cell sizes. 


```{r CVdens, fig.cap="Scale-location plots for different grid-cell sizes.  Depicting the systematic relationships between $\\hat{e}_i^*$ and the independent value $^{13}$C (Heteroscedasticity) or the homogeneity of variance (Homoscedasticity)."}
knitr::include_graphics(here("figures", "point_CV.png"))
```


Lastly, count data, from one measurement to another, should represent independent distributions, where machine-specific conditions (fluctuations in the electronics, resonance or interference by magnetic fields) could be envisioned to cause dependence among sequential measurements, this can be formulated as the strength of the correlation of consecutive measurements (or autocorrelation). The *Ljung-Box* hypothesis test employs a timeseries without autocorrelation (or "white noise") as the $H0$ to test against a sampled timeseries autocorrelation strength. The overview graph (\@ref(fig:hyp)), for the frequency of the failure to reject $H0$ of white noise, supports independence of measurement distributions.


```{r hyp, fig.cap="Overview of hypothesis test for the validation of the regression assumptions, based on studentized residuals, and including; Anderson-Darling tests for normality, Breusch-Pagan tests for homogeneity, two-sided one sample Student's t test with a $\\mu=0$ for the residuals, and Ljung-Box test for autocorrelation. In each panel, the frequency of the failure to reject the $H0$ is depicted for the different grid-cell sizes. The average count per grid-cell size is given on the secondary x-axis."}
knitr::include_graphics(here("figures", "bar_over_class.png"))
```


## Quasi Simulations Arrival {#sec:QSA}

Measuring under high ionisation efficiencies with an electron multiplier (EM) can lead to an artefact understood as the more-or-less (quasi) simultaneous arrival (QSA) of an incident ion at the detection device. Differentiation of the two secondary ions is thus not possible, and the ions are therefore counted as $1$ detection event by the machine. In the case of isotope systems this could theoretically lead to undersampling of the common isotope [@Slodzian2004]. As opposed to e.g. the deadtime correction (related to paralysis of the EM in a specific time-window), a simple solution is not straightforward, and, on top of that, the artefact can also lead to fluctuations of $R$ within a single analysis. Given that ionization efficiency fluctuating are an a common feature of routine SIMS measurements (as is underlined in this study), and likely relates to sputter pit geometry development and charge build-up [@Fitzsimons2000a], this could impact the precision as well the accuracy of an isotope analysis. One could argue that it would not matter for the validity of the here-developed tests whether detected isotope variation is related to QSA, or to the underlying data structure emanating from isotope composition of the analyte. However, it remains a fruitful endeavour to constrain whether e.g., a typical calcite mineral or carbonate rock exhibits isotopic variation at a nanoSIMS spatial resolution. More so, as correct value assignment is of high importance for RM development, which. in turn, leads to better smaller errors when constraining the isotopic composition of analytes at microscopic scales. To pursue this effort, an approximation of QSA can be undertaken by fitting a linear model to ^12^C count rates as a predictor, and ^13^C/^12^C as the independent variable. By doing so, the slope of the fitted linear model trends towards lower ^13^C/^12^C with a higher ionization efficiency (Supplementary Fig. \@ref(fig:QSA)), where the coefficients are highly significant ($p<0.001$) in both instances, based on conventional t-test statistics. Paradoxically, if the trend would reflect upon the underlying relation between ionization efficiency of the common isotope, then it cannot be reconciled with QSA and undersampling of ^12^C at higher levels of ionization efficiency. In the absence of other documented machine-related isotope fractionations, and the premise that ionization efficiency differences for isotopes of the same element are cancelled out upon division [@Fitzsimons2000a], then the linked relation between matrix and ionization yield [@Slodzian1980] most likely translates back to the analyte, which based on our analysis also exhibits correlated difference in ^13^C/^12^C. What this intra- and inter-isotopic heterogeneity encompasses is not entirely clear, but in the case of the crystalline MON, these correlative features are most compellingly relate to compositional modifications [@Eiler1997a]. These  compositional differences could also lead to variations in the IMF, if that would be the case the gradient might not be directly transferable to the analyte. However, this remains to be tested, and is also insignificant in terms of the validity of the test statistics presented here. The inter-isotopic heterogeneity of the sedimentary carbonate MEX must probably be sought in the dispersion of different minerals and phases, but as it is close to the predicted precision it is of limited significance, and the sample is effectively homogeneous in terms of the limitations of the nanoSIMS.


```{r QSA, out.extra = "", fig.cap=paste0("Approximate test for Quasi simultaneous arrival wit a random effect linear regression model fitted with Maximum Likelihood Optimization and a grouping structure based on the  based on", SI(10, c("micro", "metre")), "$\\times$", SI(10, c("micro", "metre")), " grid-cell sizes. The fixed effect for the slopes of both models are highly significant ($p<0.001$).")}
knitr::include_graphics(here("figures", "point_QSA.png"))
```


## Additional evaluation of real data

Upon visual inspection, the `r point::R_labeller("12C-14N" , "12C")` map stood-out because of its distinctive enrichment pattern, with a distinct cluster of elevated `r point::R_labeller("12C-14N" , "12C")` over the background. This underpins previous observation of (sub)micron-scale variations in the chemical make-up of the fine-dispersed mineralogical/phase variations in this sedimentary carbonate (Supplementary Section \@ref(sec:QSA)). In line with documentation of `r point::R_labeller("12C", "40Ca-16O")` in the main text, the grid-cells with elevated `r point::R_labeller("12C-14N" , "12C")` have been inspected more-closely, in order to judge their potential bearing on ^13^C/^13^C. 


```{r nitro1, fig.cap=paste0("Ion map (", point::R_labeller("12C-14N" , "12C"), ") projection and superimposed ", SI(10, c("micro", "metre")),  " by ", SI(10, c("micro", "metre")), " grid of highest-precision ", point::R_labeller("13C", "12C"), " (colored text labels) aggregated over the width, height and depth of the sedimentary carbonate (MEX). Combined intra- and inter-isotope variability is integrated as, respectively, significance stars and color of the $\\delta^{13}$C (", permille(NULL), " relative to $\\bar{\\bar{R}}$), where t-test statistics were used to allow the representation of single analyses (plane-specific $\\epsilon_{\\hat{\\bar{R}}}$ and LR test statistics in Table \\ref{tab:MEXtab}). The array encompasses 400 frames over the depth dimension (Section \\ref{sec:realdat}).")}
knitr::include_graphics(here("figures", "raster_MEX_12C14N-12C.png"))
```


In contrast to patches of elevated  `r point::R_labeller("12C", "40Ca-16O")`, a pronounced cluster of high `r point::R_labeller("12C-14N" , "12C")` (Fig. \@ref(fig:nitro2)) is marked by generally lower count rates for both ^12^C and ^13^C (Fig. \@ref(fig:nitro2)). This could suggest that this feature does not relate to an organic carbon enrichment, instead adsorbed ammonium on a clay matrix [e.g., @DeLange1992] might be a valid, alternative explanation for this chemical signature.


```{r nitro2, fig.cap=paste0("Mean and variance ($s_{X}$; see Supplementary Eq. \\ref{eq:sd}) of $^{12}$C and  $^{13}$C from selected the grid-cell of Supplementary Fig. \\ref{fig:nitro1} demarcated by a red square, and filtered for ", point::R_labeller("12C-14N" , "12C"), " , based on a threshold value of $0.75$.") }
knitr::include_graphics(here("figures", "point_MEX_ROI9.png"))
```


